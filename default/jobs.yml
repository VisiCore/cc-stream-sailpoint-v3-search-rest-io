_vct_rest_sailpoint_v3_search_identities:
  type: collection
  ttl: 4h
  ignoreGroupJobsLimit: false
  removeFields: []
  resumeOnBoot: false
  schedule: {}
  streamtags: []
  workerAffinity: false
  collector:
    conf:
      discovery:
        discoverType: none
      collectMethod: post_with_body
      pagination:
        type: response_body
        maxPages: 0
        attribute:
          - at(-1).id
      authentication: oauth
      timeout: 0
      useRoundRobinDns: false
      disableTimeFilter: false
      decodeUrl: false
      rejectUnauthorized: true
      captureHeaders: false
      stopOnEmptyResults: true
      safeHeaders: []
      retryRules:
        type: backoff
        interval: 1000
        limit: 5
        multiplier: 2
        maxIntervalMs: 20000
        codes:
          - 429
          - 503
        enableHeader: true
        retryConnectTimeout: false
        retryConnectReset: false
        retryHeaderName: retry-after
      __scheduling:
        stateTracking: {}
      loginUrl: "`https://${C.vars['endpoint_host']}.api.identitynow.com/oauth/token`"
      authHeaderKey: Authorization
      authHeaderExpr: "`Bearer ${token}`"
      clientSecretParamName: client_secret
      collectUrl: "`https://${C.vars['endpoint_host']}.api.identitynow.com/v3/search?\
        limit=1000&count=true`"
      collectBody: |
        JSON.stringify({
           indices: [
              "identities"
           ],
           query: {
              query: "*"
           },
           queryResultFilter:{
              includes: [
                 "id",
                 "name"
              ]
           },
           includeNested: false,
           sort: [
              "id"
           ],
           searchAfter: __e['at(-1).id'] !== NULL ? [__e['at(-1).id']] : NULL
        })
      collectRequestHeaders:
        - name: content-type
          value: "'application/json'"
      clientSecretParamValue: "< Enter Secret | Enter Secret >"
      authRequestParams:
        - name: grant_type
          value: "'client_credentials'"
        - name: client_id
          value: C.vars['client_id']
      tokenRespAttribute: access_token
    destructive: false
    encoding: utf8
    type: rest
  input:
    type: collection
    staleChannelFlushMs: 10000
    sendToRoutes: true
    preprocess:
      disabled: true
    throttleRatePerSec: "0"
    breakerRulesets:
      - _vct_sailpoint_v3_search_eb
    metadata:
      - name: datatype
        value: C.vars['datatype-identities']
  savedState: {}
  notifications: []
_vct_rest_sailpoint_v3_search_events:
  type: collection
  ttl: 4h
  ignoreGroupJobsLimit: false
  removeFields: []
  resumeOnBoot: false
  schedule:
    cronSchedule: "*/5 * * * *"
    maxConcurrentRuns: 1
    skippable: true
    run:
      rescheduleDroppedTasks: true
      maxTaskReschedule: 1
      logLevel: info
      jobTimeout: 60m
      mode: run
      timeRangeType: relative
      timeWarning: {}
      expression: "true"
      minTaskSize: 1MB
      maxTaskSize: 10MB
      stateTracking:
        stateUpdateExpression: "__timestampExtracted !== false && {latestTime:
          (state.latestTime || 0) > _time ? state.latestTime : _time}"
        stateMergeExpression: "(prevState.latestTime || 0) > newState.latestTime ?
          prevState : newState"
        enabled: true
      timestampTimezone: UTC
      earliest: -5m@m
    enabled: false
  streamtags: []
  workerAffinity: false
  collector:
    conf:
      discovery:
        discoverType: none
      collectMethod: post_with_body
      pagination:
        type: response_body
        maxPages: 0
        pageField: startIndex
        sizeField: count
        size: 1000
        zeroIndexed: false
        offsetField: startIndex
        limitField: count
        limit: 50
        offset: 1
        page: 1
        totalRecordField: totalResults
        attribute:
          - at(-1).id
      authentication: oauth
      timeout: 0
      useRoundRobinDns: false
      disableTimeFilter: false
      decodeUrl: true
      rejectUnauthorized: false
      captureHeaders: false
      stopOnEmptyResults: false
      safeHeaders: []
      retryRules:
        type: backoff
        interval: 1000
        limit: 5
        multiplier: 2
        maxIntervalMs: 20000
        codes:
          - 429
          - 503
        enableHeader: true
        retryConnectTimeout: false
        retryConnectReset: false
        retryHeaderName: retry-after
      __scheduling:
        stateTracking: {}
      loginUrl: "`https://${C.vars['endpoint_host']}.api.identitynow.com/oauth/token`"
      authHeaderKey: authorization
      authHeaderExpr: "`Bearer ${token}`"
      clientSecretParamName: client_secret
      loginBody: "'grant_type=client_credentials'"
      tokenRespAttribute: access_token
      username: changeme
      password: changeme
      authRequestHeaders:
        - name: scope
          value: "'sp:scope:all'"
      collectUrl: "`https://${C.vars['endpoint_host']}.api.identitynow.com/v3/search?\
        limit=1000&count=true`"
      collectRequestHeaders: []
      collectRequestParams:
        - name: limit
          value: "250"
      clientSecretParamValue: "< Enter Secret | Enter Secret >"
      authRequestParams:
        - name: client_id
          value: C.vars['client_id']
        - name: grant_type
          value: "'client_credentials'"
      collectBody: "JSON.stringify({\r

        \   indices: [\r

        \      \"events\"\r

        \   ],\r

        \   query: {\r

        \      query: \"type:*\"\r

        \   },\r

        \   sort: [\r

        \      \"id\"\r

        \   ],\r

        \   searchAfter: __e['at(-1).id'] !== NULL ? [__e['at(-1).id']] : NULL\r

        })\r\n"
    destructive: false
    encoding: utf8
    type: rest
  input:
    type: collection
    staleChannelFlushMs: 10000
    sendToRoutes: true
    preprocess:
      disabled: true
    throttleRatePerSec: "0"
    breakerRulesets:
      - _vct_sailpoint_v3_search_eb
    metadata:
      - name: datatype
        value: C.vars['datatype-events']
    pipeline: passthru
    output: devnull
  savedState: {}
  description: Pulling events from SailPoint V3 Search
  notifications: []
